// Variables globales
let questions = []; // Questions selon le thÃ¨me
let currentQuestionIndex = 0;
let score = 0;
let userName = "";
let selectedTheme = "";
let leaderboard = []; // Tableau pour le classement

// RÃ©fÃ©rences des Ã©lÃ©ments HTML
const startQuizButton = document.getElementById("start-quiz");
const userNameInput = document.getElementById("user-name");
const errorMessage = document.getElementById("error-message");
const welcomeSection = document.getElementById("welcome-section");
const rankingSection = document.getElementById("ranking-section");
const quizSection = document.getElementById("quiz-section");
const questionContainer = document.getElementById("question-container");
const answersContainer = document.getElementById("answers-container");
const themeButtons = document.querySelectorAll(".theme-button");
const returnHomeButton = document.getElementById("return-home");
const viewRankingButton = document.getElementById("view-ranking");

// Gestion des boutons de sÃ©lection de thÃ¨me
themeButtons.forEach((button) => {
    button.addEventListener("click", () => {
        themeButtons.forEach((btn) => btn.classList.remove("selected"));
        button.classList.add("selected");
        selectedTheme = button.dataset.theme;
    });
});

// Initialisation des Ã©vÃ©nements
function initializeEvents() {
    // Action du bouton "DÃ©marrer le quiz"
    startQuizButton.addEventListener("click", () => {
        userName = userNameInput.value.trim();
        if (userName === "") {
            errorMessage.textContent = "Veuillez entrer votre nom.";
            errorMessage.classList.remove("hidden");
        } else if (selectedTheme === "") {
            errorMessage.textContent = "Veuillez sÃ©lectionner un thÃ¨me.";
            errorMessage.classList.remove("hidden");
        } else {
            errorMessage.classList.add("hidden");
            startQuiz();
        }
    });

    // Action du bouton "Voir le classement"
    viewRankingButton.addEventListener("click", () => {
        welcomeSection.classList.add("hidden");
        rankingSection.classList.remove("hidden");
    });

    // Action du bouton "Retour Ã  l'accueil"
    returnHomeButton.addEventListener("click", resetQuiz);
}

// DÃ©marrage du quiz
function startQuiz() {
    // Charger les questions en fonction du thÃ¨me
    if (selectedTheme === "theme1") {
        questions = [
            { question: "Depuis quelques jours, une personne mâ€™insulte sur internet, quâ€™est-ce que je fais ?", image: "images/fake1", answers: ["Je rÃ©ponds Ã  ses provocations", "Je la supprime", "Je la signale et la bloque"], correct: 2 },
            { question: "Quelle est la mÃ©thode la plus sÃ»re pour crÃ©er un mot de passe ?", answers: ["Utiliser son prÃ©nom et sa date de naissance", "Un mÃ©lange de lettres, chiffres, et caractÃ¨res spÃ©ciaux", "RÃ©utiliser un mot de passe pour plusieurs comptes."], correct: 1 },
            { question: "Est-ce que je peux tout partager sur les rÃ©seaux sociaux ?", answers: ["Vrai", "Faux"], correct: 1 },
            { question: "Pourquoi est-il important dâ€™avoir un mot de passe difficile Ã  deviner ?", answers: ["Pour que les autres ne puissent pas accÃ©der Ã  votre compte.", "Pour impressionner vos amis.", "Pour pouvoir le retrouver facilement."], correct: 0 },
            { question: "Ma petite sÅ“ur de 11 ans a installÃ© TikTok, a-t-elle le droit ?", answers: ["Vrai", "Faux"], correct: 1 },
            { question: "Les rÃ©seaux sociaux nâ€™ont aucun impact sur la santÃ© mentale ?", answers: ["Vrai", "Faux"], correct: 1 },
            { question: "Est-ce une bonne idÃ©e de publier votre adresse ou votre numÃ©ro de tÃ©lÃ©phone sur les rÃ©seaux sociaux ?", answers: ["Oui, pour que vos amis puissent vous contacter.", "Non, car cela peut Ãªtre dangereux.", "Oui, mais seulement pendant les vacances."], correct: 1 },
            { question: "Que faut-il faire si un inconnu vous envoie un lien Ã©trange ?", answers: ["Cliquer dessus pour voir ce que câ€™est.", "Ne pas cliquer et supprimer le message.", "Partager le lien avec vos amis pour en savoir plus."], correct: 1 },
        ];
    } else if (selectedTheme === "theme2") {
        questions = [
            { question: "Quel est le premier rÃ©flexe Ã  avoir en cas de cyberharcÃ¨lement ?", answers: ["Ignorer et supprimer les messages.", "RÃ©pondre agressivement.", "Signaler lâ€™auteur et alerter une personne de confiance."], correct: 2 },
            { question: "Partager une vidÃ©o embarrassante dâ€™une autre personne sans son accord est-il autorisÃ© ?", answers: ["vrai", "faux"], correct: 1 },
            { question: "D'aprÃ¨s vous, combien de jeunes dÃ©clarent avoir Ã©tÃ© victimes de cyberharcÃ¨lement ?", answers: ["1 sur 10.", "1 sur 5.", "1 sur 2."], correct: 1 },
            { question: "Que signifie cyberharcÃ¨lement ?", answers: ["Dire des choses gentilles sur Internet.", "EmbÃªter ou insulter quelquâ€™un de faÃ§on rÃ©pÃ©tÃ©e en ligne.", "Publier une photo de soi-mÃªme."], correct: 1 },
            { question: "Que faut-il faire si quelquâ€™un vous insulte ou vous menace en ligne ?", answers: ["Bloquer la personne et signaler son compte.", "RÃ©pondre pour lâ€™insulter Ã  votre tour.", "Ignorer sans rien faire."], correct: 0 },
            { question: "Est-il acceptable de partager une photo embarrassante dâ€™un ami sans son autorisation ?", answers: ["Oui, si câ€™est pour rire.", "Non, cela peut le blesser ou lâ€™humilier.", "Oui, si vous Ãªtes trÃ¨s proches."], correct: 1 },
            { question: "Que peut-on faire si on voit quelquâ€™un se faire harceler sur un rÃ©seau social ?", answers: ["Lâ€™ignorer et passer Ã  autre chose.", "Signaler le harceleur et soutenir la personne victime.", "Partager la publication pour que tout le monde la voie."], correct: 1 },
            { question: "Est-ce que tout ce quâ€™on dit sur Internet peut Ãªtre retrouvÃ© plus tard ?", answers: ["Non, les messages disparaissent aprÃ¨s quelques jours.", "Oui, les messages ou publications peuvent Ãªtre enregistrÃ©s ou capturÃ©s.", "Non, les rÃ©seaux sociaux effacent tout automat-iquement."], correct: 1 },
        ];
    } else if (selectedTheme === "theme3") {
        questions = [
            { question: "Quâ€™est-ce quâ€™une fake news ?", answers: [" Une information humoristique.", " Une information fausse diffusÃ©e intentionnellement.", "Un article dâ€™opinion."], correct: 1 },
            { question: "Comment peut-on vÃ©rifier quâ€™une information partagÃ©e sur les rÃ©seaux est vraie ?", answers: [" En la partageant pour voir les rÃ©actions.", "En consultant des sources fiables ou officielles", "En regardant si beaucoup de gens lâ€™ont partagÃ©e."], correct: 1 },
            { question: "Pourquoi les fake news se propagent-elles si vite ?", answers: [" Parce quâ€™elles sont souvent choquantes ou surprenantes.", "Parce quâ€™elles sont toujours vÃ©rifiÃ©es avant dâ€™Ãªtre partagÃ©es.", " Parce que les gens prÃ©fÃ¨rent les informations vraies."], correct: 0 },
            { question: "Es ce que les fake news peuvent affecter la sociÃ©tÃ© ?", answers: ["Vrai", "Faux"], correct: 1 },
            { question: "RealNews or FakeNews", image: "images/fake1.png", answers: ["RealNews", "FakeNews"], correct: 1 },
        ]
    }
    currentQuestionIndex = 0;
    score = 0;
    welcomeSection.classList.add("hidden");
    rankingSection.classList.add("hidden");
    quizSection.classList.remove("hidden");
    displayQuestion();
}
function displayQuestion() {
    const currentQuestion = questions[currentQuestionIndex];

    // Nettoyer le conteneur avant d'ajouter une nouvelle question
    questionContainer.innerHTML = "";
    answersContainer.innerHTML = "";

    // Afficher la question
    questionContainer.textContent = currentQuestion.question;

    if (currentQuestion.image) {
        const img = document.createElement("img");
        img.src = currentQuestion.image;
        img.alt = "Image associÃ©e Ã  la question";
        img.style.width = "100%";
        img.style.marginTop = "10px";

        img.onload = () => {
            questionContainer.appendChild(img); // Afficher l'image aprÃ¨s son chargement
        };

        img.onerror = () => {
            console.error("Erreur lors du chargement de l'image :", currentQuestion.image);
        };
    }


    // Afficher les rÃ©ponses
    currentQuestion.answers.forEach((answer, index) => {
        const button = document.createElement("button");
        button.textContent = answer;
        button.addEventListener("click", () => checkAnswer(index));
        answersContainer.appendChild(button);
    });
}

function displayQuestion() {
    const currentQuestion = questions[currentQuestionIndex];
    questionContainer.textContent = currentQuestion.question;
    answersContainer.innerHTML = "";
    currentQuestion.answers.forEach((answer, index) => {
        const button = document.createElement("button");
        button.textContent = answer;
        button.addEventListener("click", () => checkAnswer(index));
        answersContainer.appendChild(button);
    });
}

function checkAnswer(selectedIndex) {
    const currentQuestion = questions[currentQuestionIndex];
    const isCorrect = selectedIndex === currentQuestion.correct;

    // Nettoyer le conteneur avant d'afficher le message
    questionContainer.innerHTML = "";
    answersContainer.innerHTML = "";

    // Afficher le message temporaire
    const message = document.createElement("p");
    message.textContent = isCorrect
        ? "Bonne rÃ©ponse ! ðŸŽ‰"
        : `Mauvaise rÃ©ponse ðŸ˜ž. La bonne rÃ©ponse Ã©tait : ${currentQuestion.answers[currentQuestion.correct]}`;
    message.style.color = isCorrect ? "green" : "red";
    questionContainer.appendChild(message);

    if (isCorrect) score++;

    setTimeout(() => {
        questionContainer.innerHTML = ""; // Nettoyer les anciens messages
        answersContainer.innerHTML = ""; // Nettoyer les anciens boutons
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            displayQuestion(); // Passer Ã  la prochaine question
        } else {
            endQuiz(); // Fin du quiz
        }
    }, 2000);
}

function endQuiz() {
    // Nettoyer les conteneurs de la question et des rÃ©ponses
    questionContainer.innerHTML = "";
    answersContainer.innerHTML = "";

    // Ajouter le score actuel au classement
    leaderboard.push({ name: userName, score });
    leaderboard.sort((a, b) => b.score - a.score); // Trier par score dÃ©croissant

    // Afficher la section du classement
    quizSection.classList.add("hidden");
    rankingSection.classList.remove("hidden");

    // Afficher les 3 premiers
    const top3Container = document.querySelector(".top-3");
    top3Container.innerHTML = leaderboard
        .slice(0, 3)
        .map(
            (entry, index) =>
                `<div class="row">
                    <span>${index === 0 ? "1er" : `${index + 1}iÃ¨me`}</span>
                    <span>${entry.name} - ${entry.score} pt(s)</span>
                </div>`
        )
        .join("");

    // Afficher le reste des participants
    const rankingTable = document.querySelector(".ranking-table");
    rankingTable.innerHTML = leaderboard
        .slice(3)
        .map(
            (entry, index) =>
                `<div class="row">
                    <span>${index + 4}</span>
                    <span>${entry.name} - ${entry.score} pt(s)</span>
                </div>`
        )
        .join("");
}


function resetQuiz() {
    userName = "";
    score = 0;
    currentQuestionIndex = 0;

    // RÃ©initialiser le formulaire d'entrÃ©e
    document.getElementById("user-name").value = "";

    // Masquer les sections
    welcomeSection.classList.remove("hidden");
    rankingSection.classList.add("hidden");
    quizSection.classList.add("hidden");

    // Masquer l'erreur si elle est affichÃ©e
    errorMessage.classList.add("hidden");

    // RÃ©initialiser les thÃ¨mes
    themeButtons.forEach((button) => button.classList.remove("selected"));
    selectedTheme = "";
}

// Initialiser les Ã©vÃ©nements au chargement de la page
initializeEvents();
